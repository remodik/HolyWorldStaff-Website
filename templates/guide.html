{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Главная</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ guide.title }}</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>{{ guide.title }}</h1>
                {% if current_user.access_level >= 4 %}
                <div>
                    <a href="{{ url_for('edit_guide', guide_id=guide.id) }}" class="btn btn-warning btn-sm">Редактировать</a>
                    <form action="{{ url_for('delete_guide', guide_id=guide.id) }}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Удалить это руководство?')">Удалить</button>
                    </form>
                </div>
                {% endif %}
            </div>

            <div class="card mb-4">
                <div class="card-body guide-content">
                    {{ guide.content|safe }}
                </div>
                <div class="card-footer text-muted">
                    Последнее обновление: {{ guide.last_updated.strftime('%d.%m.%Y в %H:%M') }}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Похожие руководства
                </div>
                <div class="card-body">
                    {% if related_guides %}
                        <div class="list-group">
                            {% for related in related_guides %}
                            <a href="{{ url_for('view_guide', guide_id=related.id) }}"
                               class="list-group-item list-group-item-action {% if related.id == guide.id %}active{% endif %}">
                                {{ related.title }}
                                <small class="text-muted d-block">{{ related.category }}</small>
                            </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="alert alert-info">Нет похожих руководств</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .guide-content {
        line-height: 1.6;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        word-wrap: break-word;
    }

    .guide-content p {
        margin-bottom: 1em;
        white-space: normal;
    }

    .guide-content ul {
        list-style-type: disc !important;
        margin-left: 1.5em;
        padding-left: 0;
    }

    .guide-content ul li {
        margin-bottom: 0.5em;
        display: list-item;
    }

    .guide-content ol {
        list-style-type: decimal;
        margin-left: 1.5em;
        padding-left: 0;
    }

    .guide-content ol li {
        margin-bottom: 0.5em;
        display: list-item;
    }

    .guide-content h2,
    .guide-content h3,
    .guide-content h4 {
        margin-top: 1.5em;
        margin-bottom: 0.8em;
        color: #2c3e50;
    }

    .guide-content blockquote {
        border-left: 3px solid #ddd;
        padding-left: 1em;
        margin-left: 0;
        margin-right: 0;
        color: #666;
    }

    .guide-content code {
        background-color: #f8f9fa;
        padding: 0.2em 0.4em;
        border-radius: 3px;
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .guide-content pre {
        background-color: #f8f9fa;
        padding: 1em;
        border-radius: 4px;
        overflow-x: auto;
    }
</style>
{% endblock %}